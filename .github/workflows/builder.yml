name: ğŸ©¸ BARA V3.0 - ESP32 Firmware Builder

on:
  push:
    branches: [ main, master, dev, release/* ]
    paths:
      - 'bara.ino'
      - '.github/workflows/builder.yml'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      board_type:
        description: 'ESP32 Board Type'
        required: false
        default: 'esp32dev'
        type: choice
        options:
          - esp32dev
          - esp32-s2
          - esp32-s3
          - esp32-c3
      optimization:
        description: 'Optimization Level'
        required: false
        default: 'default'
        type: choice
        options:
          - default
          - size
          - speed
          - debug

env:
  # Build Configuration
  SKETCH_NAME: bara.ino
  BUILD_DIR: build
  BOARD_TYPE: esp32dev
  PARTITION_SCHEME: default
  FLASH_MODE: dio
  FLASH_FREQ: 80
  FLASH_SIZE: 4MB
  
  # Version Info
  FIRMWARE_VERSION: v3.0
  BUILD_TIMESTAMP: ${{ github.run_number }}

jobs:
  # ==================== ğŸ” Pre-Build Validation ====================
  validate:
    name: ğŸ” Code Validation & Checks
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: ğŸ” Check File Structure
        run: |
          echo "ğŸ” Validating project structure..."
          if [ ! -f "bara.ino" ]; then
            echo "âŒ ERROR: bara.ino not found!"
            exit 1
          fi
          echo "âœ… Project structure validated"
      
      - name: ğŸ“Š Code Statistics
        run: |
          echo "ğŸ“Š Code Statistics:"
          echo "===================="
          echo "ğŸ“ Total Lines: $(wc -l < bara.ino)"
          echo "ğŸ“¦ File Size: $(du -h bara.ino | cut -f1)"
          echo "ğŸ”§ Functions: $(grep -c "void " bara.ino || echo 0)"
          echo "ğŸ“¡ Endpoints: $(grep -c 'server.on(' bara.ino || echo 0)"
      
      - name: ğŸ” Security Check
        run: |
          echo "ğŸ” Running security checks..."
          if grep -q "password.*=.*\"\"" bara.ino; then
            echo "âš ï¸ WARNING: Empty password detected"
          fi
          echo "âœ… Security check completed"

  # ==================== ğŸ—ï¸ Build for Multiple Boards ====================
  build-firmware:
    name: ğŸ—ï¸ Build ESP32 Firmware
    needs: validate
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        board:
          - name: ESP32-DevKit
            type: esp32dev
            partition: default
          - name: ESP32-S2
            type: esp32-s2-saola-1
            partition: default
          - name: ESP32-S3
            type: esp32-s3-devkitc-1
            partition: default
          - name: ESP32-C3
            type: esp32-c3-devkitm-1
            partition: default
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: ğŸ“¦ Cache Arduino CLI
        uses: actions/cache@v4
        with:
          path: |
            ~/.arduino15
            ~/Arduino/libraries
          key: ${{ runner.os }}-arduino-${{ hashFiles('**/bara.ino') }}
          restore-keys: |
            ${{ runner.os }}-arduino-
      
      - name: ğŸ”§ Install Arduino CLI
        run: |
          echo "ğŸ”§ Installing Arduino CLI..."
          curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | BINDIR=/usr/local/bin sh
          arduino-cli version
          echo "âœ… Arduino CLI installed successfully"
      
      - name: âš™ï¸ Configure Arduino CLI
        run: |
          echo "âš™ï¸ Configuring Arduino CLI..."
          arduino-cli config init --additional-urls https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
          arduino-cli config dump
          echo "âœ… Configuration completed"
      
      - name: ğŸ”„ Update Core Index
        run: |
          echo "ğŸ”„ Updating core index..."
          arduino-cli core update-index
          echo "âœ… Core index updated"
      
      - name: ğŸ“¦ Install ESP32 Core
        run: |
          echo "ğŸ“¦ Installing ESP32 core..."
          arduino-cli core install esp32:esp32@2.0.14
          arduino-cli core list
          echo "âœ… ESP32 core installed"
      
      - name: ğŸ“š Install Required Libraries
        run: |
          echo "ğŸ“š Installing required libraries..."
          
          # Core Libraries
          arduino-cli lib install "WiFi"
          arduino-cli lib install "WebServer"
          arduino-cli lib install "DNSServer"
          arduino-cli lib install "SPIFFS"
          
          # Async Libraries
          arduino-cli lib install "ESPAsyncWebServer"
          arduino-cli lib install "AsyncTCP"
          
          # JSON Library
          arduino-cli lib install "ArduinoJson@6.21.3"
          
          # Additional Dependencies
          echo "ğŸ“¦ Installing additional dependencies..."
          arduino-cli lib install "ESP32 BLE Arduino"
          
          echo "âœ… All libraries installed successfully"
          arduino-cli lib list
      
      - name: ğŸ”§ Install ESP-IDF Tools
        run: |
          echo "ğŸ”§ Installing ESP-IDF tools..."
          pip install esptool pyserial
          esptool.py version
          echo "âœ… ESP-IDF tools installed"
      
      - name: ğŸ“ Create Arduino Project Structure
        run: |
          echo "ğŸ“ Creating project structure..."
          mkdir -p bara
          cp bara.ino bara/bara.ino
          ls -la bara/
          echo "âœ… Project structure created"
      
      - name: ğŸ—ï¸ Compile Firmware - ${{ matrix.board.name }}
        run: |
          echo "ğŸ—ï¸ Building firmware for ${{ matrix.board.name }}..."
          
          arduino-cli compile \
            --fqbn esp32:esp32:${{ matrix.board.type }} \
            --build-property "build.partitions=${{ matrix.board.partition }}" \
            --build-property "upload.maximum_size=1310720" \
            --build-property "build.flash_mode=dio" \
            --build-property "build.flash_freq=80m" \
            --build-property "build.flash_size=4MB" \
            --output-dir ${{ env.BUILD_DIR }}/${{ matrix.board.type }} \
            --verbose \
            bara/bara.ino
          
          echo "âœ… Compilation completed for ${{ matrix.board.name }}"
      
      - name: ğŸ“Š Build Statistics
        run: |
          echo "ğŸ“Š Build Statistics for ${{ matrix.board.name }}:"
          echo "=================================================="
          if [ -f "${{ env.BUILD_DIR }}/${{ matrix.board.type }}/bara.ino.bin" ]; then
            SIZE=$(du -h "${{ env.BUILD_DIR }}/${{ matrix.board.type }}/bara.ino.bin" | cut -f1)
            echo "ğŸ“¦ Firmware Size: $SIZE"
            echo "ğŸ“ Build Directory Contents:"
            ls -lh ${{ env.BUILD_DIR }}/${{ matrix.board.type }}/
          else
            echo "âš ï¸ Binary file not found"
          fi
      
      - name: ğŸ”§ Create Merged Binary (0x0 Offset)
        run: |
          echo "ğŸ”§ Creating merged binary for flash at 0x0..."
          
          BUILD_PATH="${{ env.BUILD_DIR }}/${{ matrix.board.type }}"
          
          # Check if all required files exist
          if [ -f "$BUILD_PATH/bara.ino.bootloader.bin" ] && \
             [ -f "$BUILD_PATH/bara.ino.partitions.bin" ] && \
             [ -f "$BUILD_PATH/bara.ino.bin" ]; then
            
            echo "ğŸ“¦ Found all binary components"
            echo "ğŸ”— Merging binaries..."
            
            # Merge all binaries into one file at correct offsets
            # Bootloader at 0x1000, Partitions at 0x8000, App at 0x10000
            python3 -m esptool \
              --chip esp32 \
              merge_bin \
              -o "$BUILD_PATH/bara_merged.bin" \
              --flash_mode dio \
              --flash_freq 80m \
              --flash_size 4MB \
              0x1000 "$BUILD_PATH/bara.ino.bootloader.bin" \
              0x8000 "$BUILD_PATH/bara.ino.partitions.bin" \
              0x10000 "$BUILD_PATH/bara.ino.bin"
            
            echo "âœ… Merged binary created: bara_merged.bin"
            echo "ğŸ“¦ Merged binary size: $(du -h $BUILD_PATH/bara_merged.bin | cut -f1)"
            
            # Create a copy with 0x0 offset naming for clarity
            cp "$BUILD_PATH/bara_merged.bin" "$BUILD_PATH/bara_0x0_merged.bin"
            echo "âœ… Created 0x0 flash binary: bara_0x0_merged.bin"
            
          else
            echo "âš ï¸ Some binary files are missing, attempting alternative merge..."
            
            if [ -f "$BUILD_PATH/bara.ino.bin" ]; then
              echo "ğŸ“¦ Creating simplified merged binary..."
              cp "$BUILD_PATH/bara.ino.bin" "$BUILD_PATH/bara_merged.bin"
              cp "$BUILD_PATH/bara.ino.bin" "$BUILD_PATH/bara_0x0_merged.bin"
              echo "âœ… Simplified binary created"
            else
              echo "âŒ ERROR: No binary files found!"
              exit 1
            fi
          fi
      
      - name: ğŸ¯ Generate Flash Instructions
        run: |
          BUILD_PATH="${{ env.BUILD_DIR }}/${{ matrix.board.type }}"
          
          cat > "$BUILD_PATH/FLASH_INSTRUCTIONS.txt" << 'EOF'
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘  ğŸ©¸ BARA V3.0 - ESP32 Firmware Flash Instructions ğŸ©¸             â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

          ğŸ“Œ Board: ${{ matrix.board.name }}
          ğŸ“¦ Firmware Version: ${{ env.FIRMWARE_VERSION }}
          ğŸ—ï¸ Build: #${{ github.run_number }}
          ğŸ“… Date: $(date)

          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ”¥ METHOD 1: Flash Merged Binary (RECOMMENDED)
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          Using esptool.py:
          
          esptool.py --chip esp32 --port COM3 --baud 921600 \
            write_flash 0x0 bara_0x0_merged.bin
          
          Or using Arduino IDE / ESP Flash Tool:
          - File: bara_0x0_merged.bin
          - Offset: 0x0
          - Baud Rate: 921600
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ”§ METHOD 2: Flash Individual Components
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          esptool.py --chip esp32 --port COM3 --baud 921600 \
            --before default_reset --after hard_reset \
            write_flash -z --flash_mode dio --flash_freq 80m --flash_size 4MB \
            0x1000 bara.ino.bootloader.bin \
            0x8000 bara.ino.partitions.bin \
            0x10000 bara.ino.bin
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“¡ CONNECTING TO BARA V3.0
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          1. Power on your ESP32
          2. Connect to Wi-Fi:
             SSID: BARA_WARFARE
             Password: A7med@Elshab7
          3. Open browser to: http://192.168.4.1
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          âš ï¸ LEGAL WARNING
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          This tool is for AUTHORIZED SECURITY TESTING ONLY.
          Unauthorized use against networks you don't own is ILLEGAL.
          Use responsibly and ethically.
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ’¡ TROUBLESHOOTING
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          - Boot Mode Error: Hold BOOT button while connecting
          - Upload Failed: Try lower baud rate (115200)
          - Connection Issues: Erase flash first with:
            esptool.py --chip esp32 erase_flash
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“š More Information:
          - GitHub: github.com/ELSHAB7UAHED/build
          - Documentation: See README.md
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOF
          
          echo "âœ… Flash instructions generated"
          cat "$BUILD_PATH/FLASH_INSTRUCTIONS.txt"
      
      - name: ğŸ“¦ Prepare Release Artifacts
        run: |
          BUILD_PATH="${{ env.BUILD_DIR }}/${{ matrix.board.type }}"
          RELEASE_DIR="release_${{ matrix.board.type }}_${{ env.FIRMWARE_VERSION }}"
          
          echo "ğŸ“¦ Preparing release artifacts..."
          mkdir -p "$RELEASE_DIR"
          
          # Copy all binary files
          if [ -f "$BUILD_PATH/bara_0x0_merged.bin" ]; then
            cp "$BUILD_PATH/bara_0x0_merged.bin" "$RELEASE_DIR/"
          fi
          
          if [ -f "$BUILD_PATH/bara_merged.bin" ]; then
            cp "$BUILD_PATH/bara_merged.bin" "$RELEASE_DIR/"
          fi
          
          if [ -f "$BUILD_PATH/bara.ino.bin" ]; then
            cp "$BUILD_PATH/bara.ino.bin" "$RELEASE_DIR/"
          fi
          
          if [ -f "$BUILD_PATH/bara.ino.bootloader.bin" ]; then
            cp "$BUILD_PATH/bara.ino.bootloader.bin" "$RELEASE_DIR/"
          fi
          
          if [ -f "$BUILD_PATH/bara.ino.partitions.bin" ]; then
            cp "$BUILD_PATH/bara.ino.partitions.bin" "$RELEASE_DIR/"
          fi
          
          # Copy flash instructions
          cp "$BUILD_PATH/FLASH_INSTRUCTIONS.txt" "$RELEASE_DIR/"
          
          # Create build info file
          cat > "$RELEASE_DIR/BUILD_INFO.txt" << EOF
          BARA V3.0 - Build Information
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          Board: ${{ matrix.board.name }}
          Board Type: ${{ matrix.board.type }}
          Version: ${{ env.FIRMWARE_VERSION }}
          Build Number: #${{ github.run_number }}
          Build Date: $(date)
          Git Commit: ${{ github.sha }}
          Git Branch: ${{ github.ref_name }}
          
          Flash Configuration:
          - Flash Mode: DIO
          - Flash Frequency: 80MHz
          - Flash Size: 4MB
          - Partition: ${{ matrix.board.partition }}
          EOF
          
          # Create archive
          zip -r "${RELEASE_DIR}.zip" "$RELEASE_DIR"
          
          echo "âœ… Release artifacts prepared"
          echo "ğŸ“¦ Contents:"
          ls -lh "$RELEASE_DIR"/
      
      - name: ğŸ“¤ Upload Artifacts - ${{ matrix.board.name }}
        uses: actions/upload-artifact@v4
        with:
          name: BARA_V3.0_${{ matrix.board.type }}_Build${{ github.run_number }}
          path: |
            release_${{ matrix.board.type }}_${{ env.FIRMWARE_VERSION }}.zip
            release_${{ matrix.board.type }}_${{ env.FIRMWARE_VERSION }}/**/*
          retention-days: 90
          if-no-files-found: error

  # ==================== ğŸ“Š Post-Build Analysis ====================
  analysis:
    name: ğŸ“Š Build Analysis & Report
    needs: build-firmware
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Download All Artifacts
        uses: actions/download-artifact@v4
        with:
          path: artifacts
      
      - name: ğŸ“Š Generate Build Report
        run: |
          echo "ğŸ“Š Generating comprehensive build report..."
          
          cat > BUILD_REPORT.md << 'EOF'
          # ğŸ©¸ BARA V3.0 - Build Report
          
          ## ğŸ“‹ Build Summary
          
          - **Version:** ${{ env.FIRMWARE_VERSION }}
          - **Build Number:** #${{ github.run_number }}
          - **Build Date:** $(date)
          - **Git Commit:** ${{ github.sha }}
          - **Branch:** ${{ github.ref_name }}
          - **Triggered By:** ${{ github.actor }}
          
          ## ğŸ¯ Build Status
          
          âœ… All builds completed successfully
          
          ## ğŸ“¦ Artifacts Generated
          
          EOF
          
          # List all artifacts
          echo "### Available Firmware Files" >> BUILD_REPORT.md
          echo "" >> BUILD_REPORT.md
          
          find artifacts -type f -name "*.bin" | while read file; do
            SIZE=$(du -h "$file" | cut -f1)
            NAME=$(basename "$file")
            echo "- **$NAME** - Size: $SIZE" >> BUILD_REPORT.md
          done
          
          echo "" >> BUILD_REPORT.md
          echo "## ğŸ”§ Flash Instructions" >> BUILD_REPORT.md
          echo "" >> BUILD_REPORT.md
          echo "Download the appropriate firmware for your ESP32 board and flash using:" >> BUILD_REPORT.md
          echo "" >> BUILD_REPORT.md
          echo '```bash' >> BUILD_REPORT.md
          echo "esptool.py --chip esp32 --port COM3 --baud 921600 write_flash 0x0 bara_0x0_merged.bin" >> BUILD_REPORT.md
          echo '```' >> BUILD_REPORT.md
          
          cat BUILD_REPORT.md
      
      - name: ğŸ“¤ Upload Build Report
        uses: actions/upload-artifact@v4
        with:
          name: Build_Report_${{ github.run_number }}
          path: BUILD_REPORT.md
          retention-days: 90

  # ==================== ğŸš€ Create GitHub Release ====================
  release:
    name: ğŸš€ Create GitHub Release
    needs: [build-firmware, analysis]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
    
    permissions:
      contents: write
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ“¥ Download All Artifacts
        uses: actions/download-artifact@v4
        with:
          path: release_artifacts
      
      - name: ğŸ“¦ Prepare Release Files
        run: |
          echo "ğŸ“¦ Preparing release files..."
          mkdir -p release_final
          find release_artifacts -name "*.zip" -exec cp {} release_final/ \;
          find release_artifacts -name "BUILD_REPORT.md" -exec cp {} release_final/ \;
          ls -lh release_final/
      
      - name: ğŸ·ï¸ Create Release Tag
        id: tag_version
        run: |
          TAG="v3.0-build${{ github.run_number }}"
          echo "tag=$TAG" >> $GITHUB_OUTPUT
          echo "ğŸ“Œ Release tag: $TAG"
      
      - name: ğŸš€ Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ steps.tag_version.outputs.tag }}
          name: ğŸ©¸ BARA V3.0 - Build #${{ github.run_number }}
          body: |
            # ğŸ©¸ BARA V3.0 - Ultimate ESP32 Warfare Toolkit
            
            ## ğŸ“¦ Release Information
            
            - **Version:** ${{ env.FIRMWARE_VERSION }}
            - **Build:** #${{ github.run_number }}
            - **Date:** ${{ github.event.head_commit.timestamp }}
            - **Commit:** ${{ github.sha }}
            
            ## ğŸ¯ What's Included
            
            This release contains pre-compiled firmware for multiple ESP32 boards:
            
            - âœ… ESP32-DevKit (Standard)
            - âœ… ESP32-S2
            - âœ… ESP32-S3
            - âœ… ESP32-C3
            
            ## ğŸ”¥ Quick Flash
            
            ```bash
            esptool.py --chip esp32 --port COM3 --baud 921600 write_flash 0x0 bara_0x0_merged.bin
            ```
            
            ## âš ï¸ Legal Warning
            
            **FOR AUTHORIZED SECURITY TESTING ONLY**
            
            Unauthorized use against networks you don't own is illegal and punishable by law.
            
            ## ğŸ“š Documentation
            
            See `FLASH_INSTRUCTIONS.txt` in each firmware package for detailed instructions.
            
            ---
            
            **Developed by Ahmed Nour Ahmed | Qena, Egypt**
          files: release_final/*
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ==================== ğŸ§¹ Cleanup ====================
  cleanup:
    name: ğŸ§¹ Cleanup Old Artifacts
    needs: release
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ§¹ Remove Old Artifacts
        uses: c-hive/gha-remove-artifacts@v1
        with:
          age: '30 days'
          skip-recent: 10

# ==================== ğŸ“¢ Notification ====================
  notify:
    name: ğŸ“¢ Build Notification
    needs: [build-firmware, analysis]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“¢ Build Status Summary
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘      ğŸ©¸ BARA V3.0 - Build Complete ğŸ©¸                    â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "Build Number: #${{ github.run_number }}"
          echo "Status: ${{ job.status }}"
          echo "Time: $(date)"
          echo ""
          echo "âœ… All firmware builds completed successfully!"
          echo "ğŸ“¦ Artifacts ready for download"
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
