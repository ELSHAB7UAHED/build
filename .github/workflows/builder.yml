# ============================================================================
# ğŸ©¸ BARA V3.0 - Professional ESP32 Build Workflow
# ============================================================================
# Advanced GitHub Actions CI/CD Pipeline for ESP32 Firmware Compilation
# Generates merged.bin at offset 0x0 for direct ESP32 flashing
# ============================================================================

name: ğŸ”¥ BARA ESP32 Firmware Builder

on:
  push:
    branches: [ main, master, develop ]
    paths:
      - '**.ino'
      - '**.cpp'
      - '**.h'
      - '.github/workflows/builder.yml'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      debug_enabled:
        description: 'Enable debug output'
        required: false
        default: 'false'
        type: boolean
      board_type:
        description: 'ESP32 Board Type'
        required: false
        default: 'esp32dev'
        type: choice
        options:
          - esp32dev
          - esp32-s2
          - esp32-s3
          - esp32-c3

env:
  ARDUINO_CLI_VERSION: '0.35.3'
  ESP32_CORE_VERSION: '2.0.14'
  PROJECT_NAME: 'bara'
  SKETCH_PATH: 'bara.ino'
  BUILD_DIR: 'build'
  PARTITION_SCHEME: 'min_spiffs'
  
jobs:
  # ============================================================================
  # ğŸ“‹ Pre-Build Validation
  # ============================================================================
  validate:
    name: ğŸ” Code Validation & Analysis
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ” Verify Sketch File
        run: |
          echo "ğŸ” Verifying bara.ino exists..."
          if [ ! -f "bara.ino" ]; then
            echo "âŒ ERROR: bara.ino not found!"
            exit 1
          fi
          echo "âœ… Sketch file found"
          
          echo ""
          echo "ğŸ“Š File Statistics:"
          wc -l bara.ino
          ls -lh bara.ino

      - name: ğŸ“ˆ Code Statistics
        run: |
          echo "ğŸ“ˆ Generating code statistics..."
          echo "Total Lines: $(wc -l < bara.ino)"
          echo "Code Size: $(du -h bara.ino | cut -f1)"
          echo "Character Count: $(wc -c < bara.ino)"

  # ============================================================================
  # ğŸ—ï¸ Main Build Job
  # ============================================================================
  build:
    name: ğŸ—ï¸ Build ESP32 Firmware
    runs-on: ubuntu-latest
    needs: validate
    strategy:
      matrix:
        board: 
          - type: esp32dev
            fqbn: esp32:esp32:esp32
            name: ESP32-DevKit
          - type: esp32-s2
            fqbn: esp32:esp32:esp32s2
            name: ESP32-S2
          - type: esp32-s3
            fqbn: esp32:esp32:esp32s3
            name: ESP32-S3
          - type: esp32-c3
            fqbn: esp32:esp32:esp32c3
            name: ESP32-C3
    
    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Setup & Environment Configuration
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ”§ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: ğŸ“¦ Install System Dependencies
        run: |
          echo "ğŸ“¦ Installing system packages..."
          sudo apt-get update -qq
          sudo apt-get install -y -qq \
            python3-pip \
            python3-serial \
            git \
            wget \
            curl \
            jq
          echo "âœ… System dependencies installed"

      - name: ğŸ”¨ Install Arduino CLI
        run: |
          echo "ğŸ”¨ Installing Arduino CLI v${ARDUINO_CLI_VERSION}..."
          curl -fsSL https://raw.githubusercontent.com/arduino/arduino-cli/master/install.sh | sh -s ${ARDUINO_CLI_VERSION}
          
          # Move to system path
          sudo mv bin/arduino-cli /usr/local/bin/
          
          # Verify installation
          arduino-cli version
          echo "âœ… Arduino CLI installed successfully"

      - name: âš™ï¸ Configure Arduino CLI
        run: |
          echo "âš™ï¸ Initializing Arduino CLI configuration..."
          arduino-cli config init --overwrite
          
          # Add ESP32 board manager URL
          arduino-cli config add board_manager.additional_urls \
            https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
          
          echo "âœ… Arduino CLI configured"

      - name: ğŸ”„ Update Package Index
        run: |
          echo "ğŸ”„ Updating board manager index..."
          arduino-cli core update-index --additional-urls \
            https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
          echo "âœ… Index updated"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ESP32 Core Installation
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¥ Install ESP32 Core
        run: |
          echo "ğŸ“¥ Installing ESP32 Core v${ESP32_CORE_VERSION}..."
          arduino-cli core install esp32:esp32@${ESP32_CORE_VERSION} \
            --additional-urls https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json
          
          echo ""
          echo "ğŸ“‹ Installed ESP32 Core:"
          arduino-cli core list
          echo "âœ… ESP32 Core installed successfully"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Library Installation
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“š Install Required Libraries
        run: |
          echo "ğŸ“š Installing all required libraries..."
          
          # Core Libraries
          echo "ğŸ”¹ Installing ESPAsyncWebServer..."
          arduino-cli lib install "ESP Async WebServer"
          
          echo "ğŸ”¹ Installing AsyncTCP..."
          arduino-cli lib install "AsyncTCP"
          
          echo "ğŸ”¹ Installing ArduinoJson..."
          arduino-cli lib install "ArduinoJson"
          
          echo "ğŸ”¹ Installing DNSServer (included in ESP32 core)..."
          
          echo ""
          echo "ğŸ“‹ Installed Libraries:"
          arduino-cli lib list
          echo "âœ… All libraries installed successfully"

      - name: ğŸ”§ Install Additional Dependencies
        run: |
          echo "ğŸ”§ Installing Python dependencies for ESP32 tools..."
          pip3 install --upgrade esptool pyserial
          echo "âœ… Python tools installed"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Firmware Compilation
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ”¨ Compile Firmware for ${{ matrix.board.name }}
        run: |
          echo "ğŸ”¨ Compiling BARA V3.0 for ${{ matrix.board.name }}..."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          # Create build directory
          mkdir -p ${BUILD_DIR}
          
          # Compile with detailed output
          arduino-cli compile \
            --fqbn ${{ matrix.board.fqbn }} \
            --build-property "build.partitions=${PARTITION_SCHEME}" \
            --build-property "upload.maximum_size=1310720" \
            --output-dir ${BUILD_DIR} \
            --export-binaries \
            --verbose \
            ${SKETCH_PATH}
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Compilation completed successfully!"
          
          echo ""
          echo "ğŸ“¦ Generated files:"
          ls -lh ${BUILD_DIR}/

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Binary Merging & Post-Processing
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ”— Merge Binaries (0x0 Offset)
        run: |
          echo "ğŸ”— Merging binaries to create flashable merged.bin at 0x0..."
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          
          cd ${BUILD_DIR}
          
          # Find the compiled binary
          APP_BIN=$(find . -name "${PROJECT_NAME}.ino.bin" | head -n1)
          
          if [ -z "$APP_BIN" ]; then
            echo "âŒ ERROR: Application binary not found!"
            exit 1
          fi
          
          echo "ğŸ“ Found application binary: $APP_BIN"
          
          # Get partition files
          BOOTLOADER=$(find ~/.arduino15/packages/esp32 -name "bootloader_dio_80m.bin" | grep ${{ matrix.board.type }} | head -n1)
          PARTITIONS=$(find . -name "*.partitions.bin" | head -n1)
          BOOT_APP0=$(find ~/.arduino15/packages/esp32 -name "boot_app0.bin" | head -n1)
          
          echo "ğŸ“ Bootloader: $BOOTLOADER"
          echo "ğŸ“ Partitions: $PARTITIONS"
          echo "ğŸ“ Boot App0: $BOOT_APP0"
          
          # Create merged binary using esptool
          python3 -m esptool \
            --chip ${{ matrix.board.type }} \
            merge_bin \
            -o merged.bin \
            --flash_mode dio \
            --flash_freq 80m \
            --flash_size 4MB \
            0x1000 "$BOOTLOADER" \
            0x8000 "$PARTITIONS" \
            0xe000 "$BOOT_APP0" \
            0x10000 "$APP_BIN"
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Merged binary created successfully!"
          
          # Verify merged binary
          if [ -f "merged.bin" ]; then
            echo ""
            echo "ğŸ“Š Merged Binary Information:"
            ls -lh merged.bin
            echo "Size: $(du -h merged.bin | cut -f1)"
            echo "MD5: $(md5sum merged.bin | cut -d' ' -f1)"
            echo "SHA256: $(sha256sum merged.bin | cut -d' ' -f1)"
          else
            echo "âŒ ERROR: merged.bin not created!"
            exit 1
          fi

      - name: ğŸ“ Generate Build Info
        run: |
          cd ${BUILD_DIR}
          
          cat > BUILD_INFO.txt << EOF
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          ğŸ©¸ BARA V3.0 - ESP32 FIRMWARE BUILD INFO ğŸ©¸          â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“… Build Date: $(date -u '+%Y-%m-%d %H:%M:%S UTC')
          ğŸ”§ Board Type: ${{ matrix.board.name }}
          ğŸ“Ÿ FQBN: ${{ matrix.board.fqbn }}
          ğŸ”– ESP32 Core: v${ESP32_CORE_VERSION}
          ğŸ—ï¸ Arduino CLI: v${ARDUINO_CLI_VERSION}
          ğŸ“¦ Partition Scheme: ${PARTITION_SCHEME}
          ğŸ”€ Git Commit: ${GITHUB_SHA:0:7}
          ğŸŒ¿ Git Branch: ${GITHUB_REF#refs/heads/}
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          ğŸ“Š BINARY INFORMATION:
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          File: merged.bin
          Size: $(du -h merged.bin | cut -f1)
          MD5:  $(md5sum merged.bin | cut -d' ' -f1)
          SHA256: $(sha256sum merged.bin | cut -d' ' -f1)
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          ğŸ“¥ FLASHING INSTRUCTIONS:
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Method 1: Using esptool.py
          --------------------------
          esptool.py --chip ${{ matrix.board.type }} \\
                     --port /dev/ttyUSB0 \\
                     --baud 921600 \\
                     write_flash 0x0 merged.bin
          
          Method 2: Using ESP Flash Download Tool
          ---------------------------------------
          1. Open ESP Flash Download Tool
          2. Select ${{ matrix.board.name }}
          3. Add merged.bin at address 0x0
          4. Click START
          
          Method 3: Using Arduino IDE
          ---------------------------
          Tools > Partition Scheme > ${PARTITION_SCHEME}
          Sketch > Upload (with merged.bin selected)
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          âš ï¸ IMPORTANT NOTES:
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          â€¢ Flash merged.bin at offset 0x0 (zero)
          â€¢ Use 921600 baud rate for faster flashing
          â€¢ Ensure ESP32 is in bootloader mode (hold BOOT, press EN)
          â€¢ Recommended flash frequency: 80MHz
          â€¢ Flash mode: DIO
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          âš–ï¸ LEGAL WARNING:
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          This tool is for AUTHORIZED PENETRATION TESTING ONLY.
          Unauthorized use is ILLEGAL and may result in criminal charges.
          
          Use responsibly and ethically!
          
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘              Built with â¤ï¸ by Ahmed Nour Ahmed                â•‘
          â•‘                      Qena, Egypt                               â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOF
          
          echo "âœ… Build info generated"

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Artifact Upload
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ğŸ“¤ Upload Firmware Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: BARA-V3-${{ matrix.board.type }}-firmware
          path: |
            ${{ env.BUILD_DIR }}/merged.bin
            ${{ env.BUILD_DIR }}/BUILD_INFO.txt
            ${{ env.BUILD_DIR }}/*.bin
            ${{ env.BUILD_DIR }}/*.elf
          retention-days: 90
          if-no-files-found: error

      - name: ğŸ“¤ Upload Merged Binary (Main)
        uses: actions/upload-artifact@v4
        with:
          name: merged-${{ matrix.board.type }}
          path: ${{ env.BUILD_DIR }}/merged.bin
          retention-days: 90
          if-no-files-found: error

  # ============================================================================
  # ğŸ“¦ Release Creation (on tags)
  # ============================================================================
  release:
    name: ğŸš€ Create Release
    needs: build
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“¥ Download All Artifacts
        uses: actions/download-artifact@v4
        with:
          path: release-artifacts

      - name: ğŸ“¦ Package Release Files
        run: |
          mkdir -p release
          cd release-artifacts
          
          # Create individual board packages
          for board in esp32dev esp32-s2 esp32-s3 esp32-c3; do
            if [ -d "merged-${board}" ]; then
              mkdir -p ../release/${board}
              cp merged-${board}/merged.bin ../release/${board}/
              
              # Create flash script
              cat > ../release/${board}/flash.sh << 'EOF'
          #!/bin/bash
          echo "ğŸ”¥ Flashing BARA V3.0 to ESP32..."
          esptool.py --chip ${board} --port ${1:-/dev/ttyUSB0} --baud 921600 write_flash 0x0 merged.bin
          EOF
              chmod +x ../release/${board}/flash.sh
            fi
          done
          
          # Create main package
          cd ../release
          zip -r BARA-V3-Complete-Package.zip */

      - name: ğŸš€ Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            release/**/*.bin
            release/*.zip
          body: |
            # ğŸ©¸ BARA V3.0 - Ultimate ESP32 Warfare Toolkit
            
            ## ğŸ“¦ Release Files
            
            This release contains pre-compiled firmware for multiple ESP32 variants:
            
            - **ESP32-DevKit** (`merged-esp32dev`)
            - **ESP32-S2** (`merged-esp32-s2`)
            - **ESP32-S3** (`merged-esp32-s3`)
            - **ESP32-C3** (`merged-esp32-c3`)
            
            ## ğŸ“¥ Installation
            
            ```bash
            esptool.py --chip esp32 --port /dev/ttyUSB0 --baud 921600 write_flash 0x0 merged.bin
            ```
            
            ## âš ï¸ Legal Warning
            
            FOR AUTHORIZED TESTING ONLY. Unauthorized use is illegal.
            
            ---
            Built with â¤ï¸ by Ahmed Nour Ahmed | Qena, Egypt
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ============================================================================
  # ğŸ“Š Build Summary
  # ============================================================================
  summary:
    name: ğŸ“Š Build Summary
    needs: [validate, build]
    runs-on: ubuntu-latest
    if: always()
    
    steps:
      - name: ğŸ“Š Generate Summary
        run: |
          echo "# ğŸ©¸ BARA V3.0 Build Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## âœ… Build Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Board | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-DevKit | ${{ needs.build.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S2 | ${{ needs.build.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-S3 | ${{ needs.build.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ESP32-C3 | ${{ needs.build.result }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ“¦ Artifacts" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Firmware binaries are available in the Actions artifacts." >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ”— Quick Links" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- [Download Artifacts](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
          echo "- [View Logs](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
